---
title: "docker 相关手册"
date: 2023-09-02
description: "Docker使用手册参考"
type: "post"
tags: ["docker相关"]
---

# 1. Docker使用手册参考

### 1.1 镜像相关：

```bash
#拉取到本地
docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]

#启动镜像创建容器、it表示交互式终端操作，rm为关闭后移除容器（测试效果时推荐使用）
docker run -it --rm ubuntu:18.04 bash
#启动镜像指定容器名与宿主端口映射
docker run --name webserver -d -p 80:80 nginx

#列出本地镜像
docker images
docker image ls #后接名字可以指定列出的镜像

#查看镜像体积
docker system df

#删除较老的本地镜像
docker image prune
docker image rm #镜像名centos

#将容器保存为新的镜像
docker commit \
    --author "Tao Wang <twang2218@gmail.com>" \
    --message "修改了默认网页" \
    webserver \                                   #容器名
    nginx:v2                                      #新镜像名称
```

### 1.2 容器相关：

```bash
#进入容器（exit后不销毁容器）
docker exec -it container_id bash

#挂载主机目录到docker容器内
docker -v /host/dir:/target/dir image_name
#挂载多目录到container内，可以多次调用-v

#一键删除多个已经停止的容器
docker container prune

#一次尝试
xhost local:root

XAUTH=/tmp/.docker.xauth

docker run -it \
--gpus all --name movo_env --net=host \
--env="DISPLAY=$DISPLAY" \
--env="QT_X11_NO_MITSHM=1" \
--volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
--env="XAUTHORITY=$XAUTH" \
--volume="$XAUTH:$XAUTH" \
--privileged \
-v /home/qjj/Uploadto14.04:/root \
9fb09c800fbd /bin/bash
# 成功把本地目录挂载到container中，但是gazebo找不到Xserver 没办法可视化
docker run -it \
--gpus all --name movo_env \
--env="DISPLAY" --net=host \
--volume="$HOME/.Xauthority:/root/.Xauthority:rw" \
--env="QT_X11_NO_MITSHM=1" \
-v /tmp/.X11-unix:/tmp/.X11-unix:ro \
--privileged \
-v /home/qjj/Uploadto14.04:/root \
c6ece4af5581 /bin/bash

docker run -it \
--gpus all --name movo_env --net=host \
--env="DISPLAY=$DISPLAY" \
--volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
--privileged \
-v /home/qjj/Uploadto14.04:/root \
c6ece4af5581 /bin/bash
//ICRA2023 manipulator test
docker run -it \
--gpus all --name icratest --net=host \
--env="DISPLAY=$DISPLAY" \
--volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
--privileged \
d3d4db6c355a /bin/bash
```

使用容器懒得搞vpn了，修改/etc/apt/sources.list内容，指定中科大源为软件源：

```bash
apt-get update
apt-get install vim
cp /etc/apt/sources.list /etc/apt/sources.list.bak #备份一下，万一以后用呢
vim /etc/apt/sources.list
#修改内容如下
# 默认注释了源码仓库，如有需要可自行取消注释
deb https://mirrors.ustc.edu.cn/ubuntu/ trusty main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ trusty-security main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ trusty-updates main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse

deb https://mirrors.ustc.edu.cn/ubuntu/ trusty-backports main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
:wq

#报错
Is the package apt-transport-https installed
#解决办法：
cd /usr/lib/apt/methods
ln -s http https
```

### 1.3 Docker Container内部使用宿主机器的vpn转发

[wsl2 走宿主机代理设置](wsl2%20走宿主机代理设置%20703ad7ccf2d048dbadb125dd91a9d192.md)