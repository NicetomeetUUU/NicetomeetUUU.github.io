---
title: "wsl2 走宿主机代理设置"
date: 2023-08-23
description: "wsl2 走宿主机代理调整"
type: "post"
tags: ["docker相关", "wsl配置", "blog"]
---

# wsl2 走宿主机代理设置

- 在常用目录下新建一个bash脚本，在其中填入如下信息：

```bash
#!/bin/sh
hostip=$(cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }')
wslip=$(hostname -I | awk '{print $1}')
port=7890 #这里指代宿主机的代理端口
#这里插一句，由于wsl2动态分配ip地址，所以需要使用如上命令获得当前dns服务器ip
PROXY_HTTP="http://${hostip}:${port}"

set_proxy(){
    export http_proxy="${PROXY_HTTP}"
    export HTTP_PROXY="${PROXY_HTTP}"

    export https_proxy="${PROXY_HTTP}"
    export HTTPS_proxy="${PROXY_HTTP}"
}

unset_proxy(){
    unset http_proxy
    unset HTTP_PROXY
    unset https_proxy
    unset HTTPS_PROXY
}

test_setting(){
    echo "Host ip:" ${hostip}
    echo "WSL ip:" ${wslip}
    echo "Current proxy:" $https_proxy
}

if [ "$1" = "set" ]
then
    set_proxy

elif [ "$1" = "unset" ]
then
    unset_proxy

elif [ "$1" = "test" ]
then
    test_setting
else
    echo "Unsupported arguments."
fi
```

添加完毕后，使用bash运行脚本即可完成；

```bash
bash vpn.sh set
bash vpn.sh unset
bash vpn.sh test# 查看当前主机ip与宿主机ip
```