---
title: "项目总览"
date: 2023-12-17
description: "Linux下轻量级服务器实现记录"
type: "post"
tags: ["C++项目", "blog", "webserver轻量级服务器"]
---

# 项目总览
# webserver项目学习

## 本篇记录webserver项目代码与关键点实现

### fork原作者代码并拉取到本地

参考的仓库代码:https://github.com/qinguoyi/TinyWebServer

相当经典的C++项目

具体操作详见  

[Git使用教程](../Git相关/Git使用教程%2094eadd4043184fb18d4314cb6703e492.md)

## 主要的工作流程：
## 1. 通过server类集成各部分的功能
- 包括：日志写入、sql链接池、线程池、设置触发模式、事件监听与循环执行；
### 1.1 log_write函数
- 通过LOG类单例初始化，异步写入、同步写入两种模式；
### 1.2 sql_pool()函数
- 设定单例模式工作的数据库连接池，并初始化数据库信息、用户名信息与端口信息；
```c++
void WebServer::sql_pool()
{
    //初始化数据库连接池
    m_connPool = connection_pool::GetInstance();
    m_connPool->init("localhost", m_user, m_passWord, m_databaseName, 3306, m_sql_num, m_close_log);

    //初始化数据库读取表
    users->initmysql_result(m_connPool);
}
```
### 1.3 thread_pool()函数
- 

### 代码如下：
```c++
#include "config.h"
#include <yaml-cpp/yaml.h>

int main(int argc, char *argv[])
{
    //需要修改的数据库信息,登录名,密码,库名
    YAML::Node sql_config = YAML::LoadFile("./database_info/database_info.yaml");
    string user = sql_config["user"].as<string>();
    string passwd = sql_config["passwd"].as<string>();
    string databasename = sql_config["databasename"].as<string>();

    //命令行解析
    Config config;
    config.parse_arg(argc, argv);

    WebServer server;

    //初始化
    server.init(config.PORT, user, passwd, databasename, config.LOGWrite, 
                config.OPT_LINGER, config.TRIGMode,  config.sql_num,  config.thread_num, 
                config.close_log, config.actor_model);
    

    //日志
    server.log_write();

    //数据库
    server.sql_pool();

    //线程池
    server.thread_pool();

    //触发模式
    server.trig_mode();

    //监听
    server.eventListen();

    //运行
    server.eventLoop();

    return 0;
}
```