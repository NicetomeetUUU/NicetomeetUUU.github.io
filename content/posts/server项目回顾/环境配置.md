---
title: "1. 环境配置"
date: 2023-12-11
description: "Linux下轻量级服务器实现记录-环境配置部分"
type: "post"
tags: ["C++项目", "blog", "webserver轻量级服务器"]
---

# mysql数据库环境配置

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<!-- **Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)* -->

- [1. 环境安装与配置(ubuntu 20.04 x86架构)](#1-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEubuntu-2004-x86%E6%9E%B6%E6%9E%84)
- [2. 运行配置](#2-%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE)
- [3. 卸载](#3-%E5%8D%B8%E8%BD%BD)
- [4. 打包成docker镜像方便部署](#4-%E6%89%93%E5%8C%85%E6%88%90docker%E9%95%9C%E5%83%8F%E6%96%B9%E4%BE%BF%E9%83%A8%E7%BD%B2)
- [5. 需要安装cpp相关的lib才能调用mysql的头文件：](#5-%E9%9C%80%E8%A6%81%E5%AE%89%E8%A3%85cpp%E7%9B%B8%E5%85%B3%E7%9A%84lib%E6%89%8D%E8%83%BD%E8%B0%83%E7%94%A8mysql%E7%9A%84%E5%A4%B4%E6%96%87%E4%BB%B6)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->


### 1. 环境安装与配置(ubuntu 20.04 x86架构)

参考链接: [https://ubuntu.com/server/docs/databases-mysql](https://ubuntu.com/server/docs/databases-mysql)

1. 先安装mysql-server: `sudo apt-get install mysql-server`
2. 安装完毕后, server将立即启动, 可以通过service查看
    
    ```bash
    sudo service mysql status'
    #输出如下
    ● mysql.service - MySQL Community Server
         Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset>
         Active: active (running) since Wed 2024-03-06 16:01:23 CST; 1min 4s ago
       Main PID: 166010 (mysqld)
         Status: "Server is operational"
          Tasks: 37 (limit: 28653)
         Memory: 364.6M
         CGroup: /system.slice/mysql.service
                 └─166010 /usr/sbin/mysqld
    
    3月 06 16:01:22 kototo systemd[1]: Starting MySQL Community Server...
    3月 06 16:01:23 kototo systemd[1]: Started MySQL Community Server.
    ```
    
3. 运行ss命令检查mysql运行状态 
    
    ```bash
    sudo ss -tap | grep mysql
    #输出如下, 返回运行程序的进程号,文件描述符与端口号 file descriptor
    LISTEN         0            70                             127.0.0.1:33060                          0.0.0.0:*       users:(("mysqld",pid=166010,fd=21))         
    LISTEN         0            151                            127.0.0.1:mysql                          0.0.0.0:*       users:(("mysqld",pid=166010,fd=23)) 
    ```
    
4. systemd journal 可以用来解决错误, 使用如下命令获取
    
    ```bash
    sudo journalctl -u mysql
    # 该命令也会记录之前安装过的mysql处理信息, 可也中;
    ```
    
5. 在 /etc/mysql 路径下可以配置基础设置, 如日志文件输出地址, 占用端口号等
    
    ```bash
    qjj@kototo:~$ cd /etc/mysql/
    qjj@kototo:/etc/mysql$ ls
    conf.d      debian-start  my.cnf.fallback  mysql.conf.d
    debian.cnf  my.cnf        mysql.cnf
    ```
    
6. 每次修改配置后需要重启服务, 可以用如下命令完成:
    
    ```bash
    sudo systemctl restart mysql.service
    ```
    

### 2. 运行配置

- 使用sudo方法启动, 在数据库中建立本地用户或者远程用户:
    - 代码如下:
        
        ```bash
        sudo mysql
        #将会进入mysql console
        create user 'username'@'ip.address | localhost' identified by 'users_password';
        #举个例子
        create user 'qjj'@'localhost' identified by 'syqjj';
        #之后登录就可以使用用户名和密码了,非常方便
        mysql -u qjj -p
        passwd: 
        mysql>
        ```
        
- 创建数据库以方便跑项目代码:
    - 创建并添加两个表与实例:
        
        ```bash
        mysql -u qjj -p
        create database users_info
        use users_info
        create table user{
        username char(50),
        passwd char(50))Engine InnoDB;
        insert into user(username, passwd) value ('qjj', 'syqjj');
        ```
        
- 赋予用户权限:
    
    ```bash
    #使用grant为用户添加权限
    grant all on *.* to 'qjj'@'localhost';
    ```
    
- 现在即可开始测试webserver项目了；

### 3. 卸载

参考链接: [https://askubuntu.com/questions/172514/how-do-i-uninstall-mysql](https://askubuntu.com/questions/172514/how-do-i-uninstall-mysql)

- 卸载前确保已停止MySQL服务
    
    ```bash
    sudo systemstl stop mysql
    ```
    
- 将相关的包都移除
    
    ```bash
    sudo apt-get purge mysql-server mysql-client mysql-common mysql-server-core-* mysql-client-core-*
    ```
    
- 删除MySQL相关的配置与数据, 如果自定义过data存储位置需要修改`/var/lib/mysql` 为你指定过的路径
    
    ```bash
    sudo rm -rf /etc/mysql /var/lib/mysql
    ```
    

### 4. 打包成docker镜像方便部署

- [ ]  挖个坑, 准备写个动态网站自用, 放个轻量服务器上交流用；

### 5. 需要安装cpp相关的lib才能调用mysql的头文件：

```bash
sudo apt-get install libmysqlclient-dev
```