---
title: "C中线程操作学习记录"
date: 2024-08-05
description: "pthread库基础操作"
type: "post"
tags: ["C++"]
---

## 本篇记录一下pthread基础操作

### 1. 创建线程（pthread_create）：
- 需要参数包括线程id、线程属性、线程函数和传递进去的函数参数；
- 注意pthread中，传递进去的函数要接收void*类型结果，且传入的arg也为void*类型；

使用例子：

```C
#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <unisid.h>

/* 
pthread_t 线程ID，不同操作系统中有不同实现方式，可能uint、int或结构体
pthread_create()函数原型：
int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg);
thread: 线程ID
attr: 线程属性，NULL表示默认属性，线程属性内存储栈大小、返回值等信息；
start_routine: 线程函数
arg: 线程函数参数
返回值：成功返回0，失败返回错误码
*/

void *myThreadFun(void *vargp)
{
    printf("Hello World!\n");
    return NULL;
}

int main()
{
    pthread_t thread_id;
    printf("creating thread\n");
    int ret = pthread_create(&thread_id, NULL, myThreadFun, NULL);
    if (ret)
    {
        printf("Error:unable to create thread, %d\n", ret);
        exit(-1);
    }
    printf("created thread, returning\n");
    pthread_exit(NULL);
}
```

### 2. 线程退出(pthread_exit):
- 线程退出有两种方式，一种是线程函数执行完毕，一种是调用pthread_exit函数；
- pthread_exit函数可以传递一个void*类型的参数，该参数会作为线程的返回值，可以通过pthread_join函数获取；

使用例子：

```C
#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void *myThreadFun(void *vargp)
{
    printf("Hello World!\n");
    pthread_exit(NULL);
}

int main()
{
    pthread_t thread_id;
    printf("creating thread\n");
    int ret = pthread_create(&thread_id, NULL, myThreadFun, NULL);
    if (ret)
    {
        printf("Error:unable to create thread, %d\n", ret);
        exit(-1);
    }
    printf("created thread, returning\n");
    pthread_exit(NULL);
}
```

